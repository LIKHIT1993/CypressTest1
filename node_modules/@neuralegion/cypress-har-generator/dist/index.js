(()=>{"use strict";var e={23:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Plugin=void 0;const r=s(780),i=s(60),o=s(411),n=s(622);t.Plugin=class{constructor(e,t){this.logger=e,this.fileManager=t,this.entries=[]}ensureBrowserFlags(e,t){if(!this.isSupportedBrowser(e))throw new Error(`An unsupported browser family was used: ${e.name}`);return this.ensureRdpPort(this.ensureTestingFlags(t)).filter((e=>!t.includes(e)))}recordHar(e){return r.__awaiter(this,void 0,void 0,(function*(){return yield this.closeConnection(),this.connection=new i.CRIConnection({port:this.rdpPort},this.logger,new i.RetryStrategy(20,5,100)),this.entries=[],yield this.connection.open(),yield this.listenNetworkEvents(e),null}))}saveHar(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=n.join(e.outDir,e.fileName);if(this.assertFilePath(t),!this.connection)return this.logger.err("Failed to save HAR. First you should start recording."),null;try{yield this.fileManager.createFolder(e.outDir);const s=this.buildHar();s&&(yield this.fileManager.writeFile(t,s))}catch(e){this.logger.err(`Failed to save HAR: ${e.message}`)}finally{this.entries=[]}return null}))}buildHar(){if(this.entries.length){const e=new o.HarBuilder(this.entries).build();return JSON.stringify(e,null,2)}}listenNetworkEvents(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new o.NetworkObserver(e,this.connection,this.logger);yield t.subscribe((e=>r.__awaiter(this,void 0,void 0,(function*(){return this.entries.push(yield new o.EntryBuilder(e).build())}))))}))}closeConnection(){return r.__awaiter(this,void 0,void 0,(function*(){this.connection&&(yield this.connection.close(),delete this.connection)}))}assertFilePath(e){if("string"!=typeof e)throw new Error("File path must be a string.")}isSupportedBrowser(e){return["chromium"].includes(null==e?void 0:e.family)}ensureTestingFlags(e){return[...e,"--no-sandbox","--disable-background-networking","--reduce-security-for-testing","--allow-insecure-localhost","--ignore-certificate-errors"]}ensureRdpPort(e){return this.rdpPort=this.getRdpPortFromArgs(e),this.rdpPort?e:(this.rdpPort=4e4+Math.round(25e3*Math.random()),[...e,`--remote-debugging-port=${this.rdpPort}`])}getRdpPortFromArgs(e){const t=e.find((e=>e.startsWith("--remote-debugging-port=")));if(t)return+t.split("=")[1]}}},166:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CRIConnection=void 0;const r=s(780),i=r.__importStar(s(990)),o=r.__importDefault(s(323));t.CRIConnection=class{constructor(e,t,s){this.options=e,this.logger=t,this.retryStrategy=s}get network(){var e;return null===(e=this.chromeRemoteInterface)||void 0===e?void 0:e.Network}get security(){var e;return null===(e=this.chromeRemoteInterface)||void 0===e?void 0:e.Security}open(){return r.__awaiter(this,void 0,void 0,(function*(){try{this.logger.debug(i.ATTEMPT_TO_CONNECT);const{host:e,port:t}=this.options,s=yield o.default({host:e,port:t});this.logger.debug(i.CONNECTED),s.once("disconnect",(()=>this.logger.debug(i.DISCONNECTED))),this.chromeRemoteInterface=s}catch(e){if(this.logger.debug(`${i.FAILED_ATTEMPT_TO_CONNECT}: ${e.message}`),!(yield this.retryStrategy.execute((()=>this.open()))))throw new Error(i.FAILED_TO_CONNECT)}}))}close(){return r.__awaiter(this,void 0,void 0,(function*(){this.chromeRemoteInterface&&(yield this.chromeRemoteInterface.close(),this.chromeRemoteInterface.removeAllListeners(),delete this.chromeRemoteInterface,this.logger.debug(i.DISCONNECTED))}))}subscribe(e){var t,s;return r.__awaiter(this,void 0,void 0,(function*(){this.chromeRemoteInterface?(this.chromeRemoteInterface.on("event",e),yield Promise.all([null===(t=this.security)||void 0===t?void 0:t.enable(),null===(s=this.network)||void 0===s?void 0:s.enable()])):this.logger.debug(i.CONNECTION_IS_NOT_DEFINED)}))}}},990:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FAILED_TO_CONNECT=t.CONNECTION_IS_NOT_DEFINED=t.DISCONNECTED=t.CONNECTED=t.ATTEMPT_TO_CONNECT=t.FAILED_ATTEMPT_TO_CONNECT=void 0,t.FAILED_ATTEMPT_TO_CONNECT="Failed to connect to Chrome Debugging Protocol",t.ATTEMPT_TO_CONNECT="Attempting to connect to Chrome Debugging Protocol",t.CONNECTED="Connected to Chrome Debugging Protocol",t.DISCONNECTED="Chrome Debugging Protocol disconnected",t.CONNECTION_IS_NOT_DEFINED="Connection to Chrome Debugging Protocol isn't defined yet.",t.FAILED_TO_CONNECT=`${t.FAILED_ATTEMPT_TO_CONNECT}\n\nCommon situations why this would fail:\n  - you forgot to run Chrome in headless mode\n  - you use Chrome version 58 or earlier\n  - you have weird RDP configuration settings\n  \nThe stack trace for this error is:`},26:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RetryStrategy=void 0;const r=s(780);t.RetryStrategy=class{constructor(e,t,s){this._times=0,this.maxRetries=e,this.backoffTime=t,this.maximumBackoff=s}execute(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.nextTime();return t&&(yield this.delay(t),yield e()),this.maxRetries-this._times}))}delay(e){return new Promise((t=>setTimeout(t,e)))}nextTime(){if(this._times<this.maxRetries)return this.increaseBackoffTime()}increaseBackoffTime(){return this.backoffTime*=Math.pow(2,++this._times-1),Math.min(this.backoffTime,this.maximumBackoff)}}},60:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RetryStrategy=t.CRIConnection=void 0;var r=s(166);Object.defineProperty(t,"CRIConnection",{enumerable:!0,get:function(){return r.CRIConnection}});var i=s(26);Object.defineProperty(t,"RetryStrategy",{enumerable:!0,get:function(){return i.RetryStrategy}})},503:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CookieParser=void 0;const r=s(193);t.CookieParser=class{constructor(){this._lastCookiePosition=0}parseCookie(e){if(this._initialize(e)){for(let e=this._extractKeyValue();e;e=this._extractKeyValue())"$"===e.key.charAt(0)&&this._lastCookie?this._lastCookie.addAttribute(e.key.slice(1),e.value):"$version"!==e.key.toLowerCase()&&"string"==typeof e.value&&this.addCookie(e),this.advanceAndCheckCookieDelimiter();return this.flushCookie(),this._cookies}}parseSetCookie(e){if(this._initialize(e)){for(let e=this._extractKeyValue();e;e=this._extractKeyValue())this._lastCookie?this._lastCookie.addAttribute(e.key,e.value):this.addCookie(e),this.advanceAndCheckCookieDelimiter()&&this.flushCookie();return this.flushCookie(),this._cookies}}_initialize(e){return this._input=e,"string"==typeof e&&(this._cookies=[],this._lastCookie=void 0,this._originalInputLength=this._input.length,!0)}flushCookie(){this._lastCookie&&(this._lastCookie.size=this._originalInputLength-this._input.length-this._lastCookiePosition),delete this._lastCookie}_extractKeyValue(){var e,t;if(!(null===(e=this._input)||void 0===e?void 0:e.length))return;const s=/^[ \t]*([^\s=;]+)[ \t]*(?:=[ \t]*([^;\n]*))?/i.exec(this._input);if(!s)return;const r={key:this.toCamelCase(s[1]),value:null===(t=s[2])||void 0===t?void 0:t.trim(),position:this._originalInputLength-this._input.length};return this._input=this._input.slice(s[0].length),r}toCamelCase(e){return e.replace(/\s(.)/g,(e=>e.toUpperCase())).replace(/\s/g,"").replace(/^(.)/,(e=>e.toLowerCase()))}advanceAndCheckCookieDelimiter(){const e=/^\s*[\n;]\s*/.exec(this._input);return!!e&&(this._input=this._input.slice(e[0].length),null!==e[0].match("\n"))}addCookie(e){this._lastCookie&&(this._lastCookie.size=e.position-this._lastCookiePosition),this._lastCookie="string"==typeof e.value?new r.NetworkCookie(e.key,e.value):new r.NetworkCookie("",e.key),this._lastCookiePosition=e.position,this._cookies.push(this._lastCookie)}}},851:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntryBuilder=void 0;const r=s(780);t.EntryBuilder=class{constructor(e){this.request=e}build(){var e;return r.__awaiter(this,void 0,void 0,(function*(){let t=this.request.remoteAddress;const s=t.lastIndexOf(":");-1!==s&&(t=t.substr(0,s));const r=this.buildTimings(),i=Object.values(r).reduce(((e,t)=>e+Math.max(t,0)),0),o={startedDateTime:new Date(1e3*this.request.getWallTime(this.request.issueTime)).toJSON(),time:i,request:yield this.buildRequest(),response:yield this.buildResponse(),cache:{},timings:r,serverIPAddress:t.replace(/\[]/g,""),_priority:this.request.priority,_resourceType:this.request.resourceType,_webSocketMessages:null!==(e=this.request.frames)&&void 0!==e?e:[]};return"0"!==this.request.connectionId&&(o.connection=this.request.connectionId),o}))}getResponseBodySize(){return 304===this.request.statusCode?0:this.request.responseHeadersText?this.request.transferSize-this.request.responseHeadersText.length:-1}getResponseCompression(){if(304!==this.request.statusCode&&206!==this.request.statusCode&&this.request.responseHeadersText)return this.request.resourceSize-this.getResponseBodySize()}toMilliseconds(e){return-1===e?-1:1e3*e}buildRequest(){var e,t,s,i;return r.__awaiter(this,void 0,void 0,(function*(){const r={method:this.request.requestMethod,url:this.buildRequestURL(this.request.url),httpVersion:this.request.requestHttpVersion,headers:this.request.requestHeaders,queryString:[...null!==(e=this.request.queryParameters)&&void 0!==e?e:[]],cookies:this.buildCookies(null!==(t=this.request.requestCookies)&&void 0!==t?t:[]),headersSize:null!==(i=null===(s=this.request.requestHeadersText)||void 0===s?void 0:s.length)&&void 0!==i?i:-1,bodySize:yield this.requestBodySize()},o=yield this.buildPostData();return o&&(r.postData=o),r}))}buildResponse(){var e,t,s;return r.__awaiter(this,void 0,void 0,(function*(){return{status:this.request.statusCode,statusText:this.request.statusText,httpVersion:this.request.responseHttpVersion(),headers:this.request.responseHeaders,cookies:this.buildCookies(this.request.responseCookies||[]),content:yield this.buildContent(),redirectURL:null!==(e=this.request.responseHeaderValue("Location"))&&void 0!==e?e:"",headersSize:null!==(s=null===(t=this.request.responseHeadersText)||void 0===t?void 0:t.length)&&void 0!==s?s:-1,bodySize:this.getResponseBodySize(),_transferSize:this.request.transferSize}}))}buildContent(){var e;return r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.request.contentData();return Object.assign({size:this.request.resourceSize,mimeType:this.request.mimeType||"x-unknown",compression:null!==(e=this.getResponseCompression())&&void 0!==e?e:void 0},t)}))}buildTimings(){var e;const t=this.request.timing,s=this.request.issueTime,r=this.request.startTime,i={blocked:-1,dns:-1,ssl:-1,connect:-1,send:0,wait:0,receive:0},o=s<r?r-s:-1;i.blocked=this.toMilliseconds(o);let n=0;if(t){const e=this.leastNonNegative([t.dnsStart,t.connectStart,t.sendStart]);e!==1/0&&(i.blocked+=e);const s=t.dnsEnd>=0?e:0,r=t.dnsEnd>=0?t.dnsEnd:-1;i.dns=r-s;const o=t.sslEnd>0?t.sslStart:0,a=t.sslEnd>0?t.sslEnd:-1;i.ssl=a-o;const u=t.connectEnd>=0?this.leastNonNegative([r,e]):0,d=t.connectEnd>=0?t.connectEnd:-1;i.connect=d-u;const h=t.sendEnd>=0?Math.max(d,r,e):0,c=t.sendEnd>=0?t.sendEnd:0;i.send=c-h,i.send<0&&(i.send=0),n=Math.max(c,d,a,r,e,0)}else if(-1===this.request.responseReceivedTime)return i.blocked=this.request.endTime-s,i;const a=null!==(e=null==t?void 0:t.requestTime)&&void 0!==e?e:r,u=n,d=this.toMilliseconds(this.request.responseReceivedTime-a);i.wait=d-u;const h=d,c=this.toMilliseconds(this.request.endTime-a);return i.receive=Math.max(c-h,0),i}leastNonNegative(e){const t=e.find((e=>e>=0));return null!=t?t:-1}buildPostData(){var e;return r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.request.requestFormData();if(!t)return;const s={mimeType:null!==(e=this.request.requestContentType)&&void 0!==e?e:"",text:t},r=yield this.request.formParameters();return r&&(s.params=[...r]),s}))}buildRequestURL(e){return e.split("#",2)[0]}buildCookies(e){return e.map(this.buildCookie.bind(this))}buildCookie(e){var t;return{name:e.name,value:e.value,path:e.path,domain:e.domain,expires:null===(t=e.expiresDate(new Date(1e3*this.request.getWallTime(this.request.startTime))))||void 0===t?void 0:t.toJSON(),httpOnly:e.httpOnly,secure:e.secure}}requestBodySize(){return r.__awaiter(this,void 0,void 0,(function*(){return(yield this.request.requestFormData())?this.request.contentLength:0}))}}},777:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtraInfoBuilder=void 0,t.ExtraInfoBuilder=class{constructor(e){this.deleteCallback=e,this._hasExtraInfo=!1,this._finished=!1,this._requests=[],this._requestExtraInfo=[],this._responseExtraInfo=[]}addRequest(e){this._requests.push(e)}addRequestExtraInfo(e){this._requestExtraInfo.push(e),this._hasExtraInfo=!0,this.sync()}addResponseExtraInfo(e){this._responseExtraInfo.push(e),this.sync()}finished(){this._finished=!0,this.deleteIfComplete()}deleteIfComplete(){if(this._finished){if(this._hasExtraInfo){const e=this.getLastRequest();if(!(null==e?void 0:e.hasExtraResponseInfo))return}this.deleteCallback()}}getLastRequest(){return this._requests[this._requests.length-1]}getRequestIndex(e){return this._requests.indexOf(e)}sync(){const e=this.getLastRequest();if(!e)return;const t=this.getRequestIndex(e),s=this._requestExtraInfo[t];s&&(e.addExtraRequestInfo(s),delete this._requestExtraInfo[t]);const r=this._responseExtraInfo[t];r&&(e.addExtraResponseInfo(r),delete this._responseExtraInfo[t]),this.deleteIfComplete()}}},977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HarBuilder=void 0,t.HarBuilder=class{constructor(e){this.entries=e}build(){const{name:e,version:t,homepage:r}=s(306);return{log:{version:"1.2",pages:[],creator:{name:e,version:t,comment:r},entries:this.entries}}}}},193:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkCookie=void 0,function(e){e.NAME="name",e.VALUE="value",e.SIZE="size",e.DOMAIN="domain",e.PORT="port",e.PATH="path",e.EXPIRES="expires",e.HTTPONLY="httponly",e.SECURE="secure",e.SAMESITE="samesite",e.MAXAGE="max-age"}(s||(s={})),t.NetworkCookie=class{constructor(e,t){this._attributes=new Map,this._size=0,this._name=e,this._value=t}get size(){return this._size}set size(e){this._size=e}get name(){return this._name}get value(){return this._value}get httpOnly(){return this._attributes.has(s.HTTPONLY)}get secure(){return this._attributes.has(s.SECURE)}get sameSite(){return this._attributes.get(s.SAMESITE)}get session(){return!(this._attributes.has(s.EXPIRES)||this._attributes.has(s.MAXAGE))}get path(){return this._attributes.get(s.PATH)}get port(){return this._attributes.get(s.PORT)}get domain(){return this._attributes.get(s.DOMAIN)}get expires(){return this._attributes.get(s.EXPIRES)}get maxAge(){var e;const t=null!==(e=this._attributes.get(s.MAXAGE))&&void 0!==e?e:"";return isNaN(+t)?void 0:+t}get url(){return(this.secure?"https://":"http://")+this.domain+this.path}expiresDate(e){if(this.maxAge){const t=null===e?new Date:e;return new Date(t.getTime()+1e3*this.maxAge)}if(this.expires)return new Date(this.expires)}addAttribute(e,t){this._attributes.set(e.toLowerCase(),t)}}},703:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkObserver=void 0;const r=s(780),i=s(147),o=s(777);t.NetworkObserver=class{constructor(e,t,s){this.options=e,this.connection=t,this.logger=s,this._entries=new Map,this._extraInfoBuilders=new Map;const{network:r,security:i}=this.connection;this.network=r,this.security=i}subscribe(e){return r.__awaiter(this,void 0,void 0,(function*(){this.destination=t=>e(t),yield this.connection.subscribe((e=>this.handleEvent(e))),this.security.certificateError((({eventId:e})=>this.security.handleCertificateError({eventId:e,action:"continue"}))),yield Promise.all([this.security.setOverrideCertificateErrors({override:!0}),this.network.setCacheDisabled({cacheDisabled:!0}),this.network.setBypassServiceWorker({bypass:!0})])}))}signedExchangeReceived(e){const t=this._entries.get(e.requestId);t&&(t.signedExchangeInfo=e.info,t.resourceType="SignedExchange",this.updateNetworkRequestWithResponse(t,e.info.outerResponse))}requestWillBeSent({type:e,loaderId:t,initiator:s,redirectResponse:r,documentURL:i,frameId:o,timestamp:n,requestId:a,request:u,wallTime:d}){let h=this._entries.get(a);if(h){if(!r)return;h.signedExchangeInfo||this.responseReceived({requestId:a,loaderId:t,timestamp:n,type:"Other",response:r,frameId:o}),h=this._appendRedirect(a,n,u.url)}else h=this.createRequest(a,o,t,u.url,i,s);this.updateNetworkRequestWithRequest(h,u),h.setIssueTime(n,d),h.resourceType=null!=e?e:"Other",this.getExtraInfoBuilder(a).addRequest(h),this.startRequest(h)}dataReceived({requestId:e,dataLength:t,encodedDataLength:s,timestamp:r}){const i=this._entries.get(e);i&&(i.resourceSize+=t,-1!==s&&i.increaseTransferSize(s),i.endTime=r)}responseReceived({requestId:e,response:t,timestamp:s,type:r}){const i=this._entries.get(e);i&&(i.responseReceivedTime=s,i.resourceType=r,this.updateNetworkRequestWithResponse(i,t))}resourceChangedPriority({requestId:e,newPriority:t}){const s=this._entries.get(e);s&&(s.priority=t)}loadingFinished({requestId:e,timestamp:t,encodedDataLength:s}){return r.__awaiter(this,void 0,void 0,(function*(){const r=this._entries.get(e);r&&this.finishRequest(r,t,s)}))}loadingFailed({requestId:e,errorText:t,canceled:s,type:r,timestamp:i}){const o=this._entries.get(e);if(!o)return;o.resourceType=r,this.finishRequest(o,i,-1);const n=t||s&&"Canceled";this.logger.debug(`Failed request: ${e}. Reason: ${n}`)}webSocketCreated({initiator:e,requestId:t,url:s}){const r=this.createRequest(t,"","",s,"",e);this.startRequest(r)}webSocketWillSendHandshakeRequest({request:e,requestId:t,timestamp:s,wallTime:r}){const i=this._entries.get(t);i&&(i.requestMethod="GET",i.requestHeaders=this.headersMapToHeadersArray(e.headers),i.setIssueTime(s,r))}webSocketHandshakeResponseReceived({timestamp:e,response:t,requestId:s}){const r=this._entries.get(s);r&&(r.statusCode=t.status,r.statusText=t.statusText,r.responseHeaders=this.headersMapToHeadersArray(t.headers),r.responseHeadersText=t.headersText||"",t.requestHeaders&&(r.requestHeaders=this.headersMapToHeadersArray(t.requestHeaders)),t.requestHeadersText&&(r.requestHeadersText=t.requestHeadersText),r.responseReceivedTime=e,r.protocol="websocket")}webSocketFrameSent({requestId:e,timestamp:t,response:s}){const r=this._entries.get(e);r&&(r.addProtocolFrame(s,t,!0),r.responseReceivedTime=t)}webSocketFrameReceived({requestId:e,timestamp:t,response:s}){const r=this._entries.get(e);r&&(r.addProtocolFrame(s,t,!1),r.responseReceivedTime=t)}webSocketFrameError({errorMessage:e,requestId:t,timestamp:s}){const r=this._entries.get(t);r&&(r.addProtocolFrameError(e,s),r.responseReceivedTime=s)}webSocketClosed({requestId:e,timestamp:t}){const s=this._entries.get(e);s&&this.finishRequest(s,t,-1)}requestWillBeSentExtraInfo({requestId:e,headers:t}){this.getExtraInfoBuilder(e).addRequestExtraInfo({requestHeaders:this.headersMapToHeadersArray(t)})}responseReceivedExtraInfo({requestId:e,headers:t,headersText:s}){this.getExtraInfoBuilder(e).addResponseExtraInfo({responseHeaders:this.headersMapToHeadersArray(t),responseHeadersText:s})}getExtraInfoBuilder(e){return this._extraInfoBuilders.has(e)||this._extraInfoBuilders.set(e,new o.ExtraInfoBuilder((()=>{this._extraInfoBuilders.delete(e)}))),this._extraInfoBuilders.get(e)}_appendRedirect(e,t,s){const r=this._entries.get(e);let i=0,o=r.redirectSource;for(;o;)i++,o=o.redirectSource;r.markAsRedirect(i),this.finishRequest(r,t,-1);const n=this.createRequest(e,r.frameId,r.loaderId,s,r.documentURL,r.initiator);return n.redirectSource=r,n}finishRequest(e,t,s){if(e.endTime=t,s>=0){const t=e.redirectSource;(null==t?void 0:t.signedExchangeInfo)?(e.transferSize=0,t.transferSize=s):e.transferSize=s}this.options.content&&e.setContentData(this.network.getResponseBody({requestId:e.requestId})),this._entries.delete(e.requestId),this.getExtraInfoBuilder(e.requestId).finished(),this.excludeRequest(e)||this.destination(e)}startRequest(e){this._entries.set(e.requestId,e)}updateNetworkRequestWithRequest(e,t){e.requestMethod=t.method,e.requestHeaders=this.headersMapToHeadersArray(t.headers),e.setRequestFormData(this.getRequestPostData(e.requestId,t)),e.initialPriority=t.initialPriority}getRequestPostData(e,t){return t.hasPostData&&t.postData?t.postData:this.network.getRequestPostData({requestId:e}).then((({postData:e})=>e)).catch((()=>{}))}createRequest(e,t,s,r,o,n){return new i.NetworkRequest(e,r,o,t,s,n)}updateNetworkRequestWithResponse(e,t){var s,r;t.url&&e.url!==t.url&&e.setUrl(t.url),e.mimeType=t.mimeType,e.statusCode=t.status,e.statusText=t.statusText,e.hasExtraResponseInfo||(e.responseHeaders=this.headersMapToHeadersArray(t.headers)),t.encodedDataLength>=0&&(e.transferSize=t.encodedDataLength),t.requestHeaders&&!e.hasExtraRequestInfo&&(e.requestHeaders=this.headersMapToHeadersArray(t.requestHeaders),e.requestHeadersText=null!==(s=t.requestHeadersText)&&void 0!==s?s:""),e.connectionReused=t.connectionReused,e.connectionId=String(t.connectionId),t.remoteIPAddress&&e.setRemoteAddress(t.remoteIPAddress,t.remotePort||-1),e.timing=t.timing,e.protocol=null!==(r=t.protocol)&&void 0!==r?r:""}headersMapToHeadersArray(e){return Object.keys(e).reduce(((t,s)=>{const r=e[s].split("\n");return t.push(...r.map((e=>({name:s,value:e})))),t}),[])}excludeRequest(e){var t;const{path:s="/"}=e.parsedURL;return!!(null===(t=this.options.excludePaths)||void 0===t?void 0:t.some((e=>new RegExp(e).test(s))))}handleEvent({method:e,params:t}){const s=this[e.substring(e.indexOf(".")+1)];s&&s.call(this,t)}}},147:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRequest=t.WebSocketFrameType=void 0;const r=s(780),i=s(503),o=s(835);var n;!function(e){e.REQUEST="request",e.RESPONSE="response",e.ERROR="error"}(n=t.WebSocketFrameType||(t.WebSocketFrameType={}));class a{constructor(e,t,s,r="",i,o){this._requestId=e,this.documentURL=s,this.frameId=r,this.loaderId=i,this.initiator=o,this._wallIssueTime=-1,this._requestHeaderValues=new Map,this._responseHeaderValues=new Map,this._requestFormData=Promise.resolve(void 0),this._hasExtraResponseInfo=!1,this._hasExtraRequestInfo=!1,this._connectionId="0",this._protocol="",this._requestTime=0,this._requestMethod="",this._statusText="",this._remoteAddress="",this._startTime=-1,this._issueTime=-1,this._endTime=-1,this._responseReceivedTime=-1,this._resourceSize=0,this._transferSize=0,this._resourceType="Other",this._requestHeaders=[],this._requestHeadersText="",this._connectionReused=!1,this._responseHeaders=[],this._responseHeadersText="",this._frames=[],this._statusCode=0,this.setUrl(t)}set signedExchangeInfo(e){this._signedExchangeInfo=e}get hasExtraResponseInfo(){return this._hasExtraResponseInfo}set hasExtraResponseInfo(e){this._hasExtraResponseInfo=e}get hasExtraRequestInfo(){return this._hasExtraRequestInfo}set hasExtraRequestInfo(e){this._hasExtraRequestInfo=e}get connectionId(){return this._connectionId}set connectionId(e){this._connectionId=e}get protocol(){return this._protocol}set protocol(e){this._protocol=null!=e?e:""}get requestTime(){return this._requestTime}set requestTime(e){this._requestTime=null!=e?e:0}get requestMethod(){return this._requestMethod}set requestMethod(e){this._requestMethod=null!=e?e:""}get statusText(){return this._statusText}set statusText(e){this._statusText=null!=e?e:""}get parsedURL(){return this._parsedURL}get url(){return this._url}get remoteAddress(){return this._remoteAddress}get startTime(){return this._startTime||-1}get issueTime(){return this._issueTime}get endTime(){return this._endTime||-1}set endTime(e){this.timing&&this.timing.requestTime?this._endTime=Math.max(e,this.responseReceivedTime):(this._endTime=e,this._responseReceivedTime>e&&(this._responseReceivedTime=e))}get responseReceivedTime(){return this._responseReceivedTime||-1}set responseReceivedTime(e){this._responseReceivedTime=e}get resourceSize(){return this._resourceSize||0}set resourceSize(e){this._resourceSize=null!=e?e:0}get transferSize(){return this._transferSize||0}set transferSize(e){this._transferSize=null!=e?e:0}get timing(){return this._timing}set timing(e){if(!e)return;this._startTime=e.requestTime;const t=e.requestTime+e.receiveHeadersEnd/1e3;((this._responseReceivedTime||-1)<0||this._responseReceivedTime>t)&&(this._responseReceivedTime=t),this._startTime>this._responseReceivedTime&&(this._responseReceivedTime=this._startTime),this._timing=e}get mimeType(){return this._mimeType}set mimeType(e){this._mimeType=e}get resourceType(){return this._resourceType}set resourceType(e){this._resourceType=null!=e?e:"Other"}get redirectSource(){return this._redirectSource}set redirectSource(e){this._redirectSource=e}get requestHeaders(){return this._requestHeaders}set requestHeaders(e){this._requestHeaders=e,this._requestHeaderValues.clear(),delete this._requestCookies}get requestCookies(){if(!this._requestCookies){const e=this.requestHeaderValue("Cookie");this._requestCookies=(new i.CookieParser).parseCookie(e)}return this._requestCookies}get contentLength(){const e=this.requestHeaderValue("Content-Length");return isNaN(+e)?0:parseInt(e,10)}get requestHeadersText(){return this._requestHeadersText}set requestHeadersText(e){this._requestHeadersText=e}get connectionReused(){return this._connectionReused}set connectionReused(e){this._connectionReused=e}get responseHeaders(){return this._responseHeaders||[]}set responseHeaders(e){this._responseHeaders=e,delete this._responseCookies,this._responseHeaderValues.clear()}get responseHeadersText(){return this._responseHeadersText}set responseHeadersText(e){this._responseHeadersText=e}get responseCookies(){if(!this._responseCookies){const e=this.responseHeaderValue("Set-Cookie");this._requestCookies=(new i.CookieParser).parseSetCookie(e)}return this._responseCookies}get queryString(){if(void 0!==this._queryString)return this._queryString;let e=null;const t=this.url.indexOf("?");if(-1!==t){e=this.url.substring(t+1);const s=e.indexOf("#");-1!==s&&(e=e.substring(0,s))}return this._queryString=e,this._queryString}get initialPriority(){return this._initialPriority}set initialPriority(e){this._initialPriority=e}get frames(){return this._frames}get statusCode(){return this._statusCode}set statusCode(e){this._statusCode=e}get requestId(){return this._requestId}get requestHttpVersion(){if(this.requestHeadersText){const e=this.requestHeadersText.split(/\r\n/)[0].match(/(HTTP\/\d+\.\d+)$/);return e?e[1]:"HTTP/0.9"}return this.requestHeaderValue("version")||this.requestHeaderValue(":version")||this.getFilteredProtocolName()}get queryParameters(){return this._parsedQueryParameters?this._parsedQueryParameters:this.queryString?(this._parsedQueryParameters=this.parseParameters(this.queryString),this._parsedQueryParameters):null}get requestContentType(){return this.requestHeaderValue("Content-Type")}get priority(){var e,t;return null!==(t=null!==(e=this._currentPriority)&&void 0!==e?e:this._initialPriority)&&void 0!==t?t:void 0}set priority(e){this._currentPriority=e}static escapeCharacters(e,t="^[]{}()\\\\.$*+?|"){let s=!1;const r=t.length;for(let i=0;i<r;++i)if(-1!==e.indexOf(t.charAt(i))){s=!0;break}if(!s)return e;let i="";for(let s=0;s<e.length;++s)-1!==t.indexOf(e.charAt(s))&&(i+="\\"),i+=e.charAt(s);return i}setUrl(e){this._url!==e&&(this._url=e,this._parsedURL=o.parse(e),delete this._queryString,delete this._parsedQueryParameters)}setRemoteAddress(e,t){this._remoteAddress=`${e}:${t}`}setIssueTime(e,t){this._issueTime=e,this._wallIssueTime=t,this._startTime=e}increaseTransferSize(e){this._transferSize=(this._transferSize||0)+e}requestFormData(){return this._requestFormData}setRequestFormData(e){this._requestFormData="string"==typeof e?Promise.resolve(e):e,this._formParametersPromise=null}getWallTime(e){return this._wallIssueTime?this._wallIssueTime-this._issueTime+e:e}formParameters(){return this._formParametersPromise||(this._formParametersPromise=this.parseFormParameters()),this._formParametersPromise}responseHttpVersion(){if(this._responseHeadersText){const e=this._responseHeadersText.split(/\r\n/)[0].match(/^(HTTP\/\d+\.\d+)/);return e?e[1]:"HTTP/0.9"}return this.responseHeaderValue("version")||this.responseHeaderValue(":version")||this.getFilteredProtocolName()}setContentData(e){"WebSocket"===this.resourceType&&(this._contentData=Promise.resolve({error:"Content for WebSockets is currently not supported"})),this._contentData=e.then((({body:e,base64Encoded:t})=>({text:e,encoding:t?"base64":void 0}))).catch((e=>({error:e.message})))}contentData(){return this._contentData}addProtocolFrameError(e,t){this.addFrame({type:n.ERROR,data:e,time:t,opcode:-1,mask:!1})}addProtocolFrame(e,t,s){const r=s?n.REQUEST:n.RESPONSE;this.addFrame({type:r,data:e.payloadData,time:t,opcode:e.opcode,mask:e.mask})}markAsRedirect(e){this._requestId=`${this.requestId}:redirected.${e}`}addExtraRequestInfo(e){this.requestHeaders=e.requestHeaders,this._hasExtraRequestInfo=!0,this.requestHeadersText=""}addExtraResponseInfo(e){if(this.responseHeaders=e.responseHeaders,e.responseHeadersText&&(this.responseHeadersText=e.responseHeadersText,this.requestHeadersText)){let e=`${this._requestMethod} ${this.parsedURL.path}`;this.parsedURL.query&&(e+=`?${this.parsedURL.query}`),e+=" HTTP/1.1\r\n";for(const{name:t,value:s}of this.requestHeaders)e+=`${t}: ${s}\r\n`;this.requestHeadersText=e}this._hasExtraResponseInfo=!0}responseHeaderValue(e){return this._responseHeaderValues.has(e)||this._responseHeaderValues.set(e,this.computeHeaderValue(this.responseHeaders,e)),this._responseHeaderValues.get(e)}parseFormParameters(){var e,t;return r.__awaiter(this,void 0,void 0,(function*(){if(null===(e=this.requestContentType)||void 0===e?void 0:e.match(/^application\/x-www-form-urlencoded\s*(;.*)?$/i)){const e=yield this.requestFormData();if(!e)return;return this.parseParameters(e)}const s=null===(t=this.requestContentType)||void 0===t?void 0:t.match(/^multipart\/form-data\s*;\s*boundary\s*=\s*(\S+)\s*$/);if(!s)return;const r=s[1];if(!r)return;const i=yield this.requestFormData();return i?this.parseMultipartFormDataParameters(i,r):void 0}))}parseMultipartFormDataParameters(e,t){const s=a.escapeCharacters(t),r=new RegExp('^\\r\\ncontent-disposition\\s*:\\s*form-data\\s*;\\s*name="([^"]*)"(?:\\s*;\\s*filename="([^"]*)")?(?:\\r\\ncontent-type\\s*:\\s*([^\\r\\n]*))?\\r\\n\\r\\n(.*)\\r\\n$',"is");return e.split(new RegExp(`--${s}(?:--s*$)?`,"g")).reduce(((e,t)=>{const[s,i,o]=t.match(r)||[];return s?(e.push({name:i,value:o}),e):e}),[])}addFrame(e){this._frames.push(e)}requestHeaderValue(e){return this._requestHeaderValues.has(e)||this._requestHeaderValues.set(e,this.computeHeaderValue(this.requestHeaders,e)),this._requestHeaderValues.get(e)}getFilteredProtocolName(){const e=this._protocol.toLowerCase();return"h2"===e?"http/2.0":e.replace(/^http\/2(\.0)?\+/,"http/2.0+")}parseParameters(e){return e.split("&").map((e=>{const t=e.indexOf("=");return-1===t?{name:e,value:""}:{name:e.substring(0,t),value:e.substring(t+1)}}))}computeHeaderValue(e,t){t=t.toLowerCase();const s=e.filter((({name:e})=>e.toLowerCase()===t)).map((({value:e})=>e));if(s.length)return"set-cookie"===t?s.join("\n"):s.join(", ")}}t.NetworkRequest=a},411:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketFrameType=t.NetworkRequest=t.NetworkObserver=t.HarBuilder=t.EntryBuilder=void 0;var r=s(851);Object.defineProperty(t,"EntryBuilder",{enumerable:!0,get:function(){return r.EntryBuilder}});var i=s(977);Object.defineProperty(t,"HarBuilder",{enumerable:!0,get:function(){return i.HarBuilder}});var o=s(703);Object.defineProperty(t,"NetworkObserver",{enumerable:!0,get:function(){return o.NetworkObserver}});var n=s(147);Object.defineProperty(t,"NetworkRequest",{enumerable:!0,get:function(){return n.NetworkRequest}}),Object.defineProperty(t,"WebSocketFrameType",{enumerable:!0,get:function(){return n.WebSocketFrameType}})},699:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileManager=void 0;const r=s(780),i=s(767),o=s(669),n=s(747);class a{constructor(){this._access=o.promisify(n.access),this._unlink=o.promisify(n.unlink),this._writeFile=o.promisify(n.writeFile),this._mkdir=o.promisify(n.mkdir)}static get Instance(){return this._instance||(this._instance=new a),this._instance}writeFile(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{yield this.removeFile(e),yield this._writeFile(e,t)}catch(e){i.Logger.Instance.err(e)}}))}createFolder(e){return r.__awaiter(this,void 0,void 0,(function*(){try{if(yield this.exists(e))return;yield this._mkdir(e)}catch(e){i.Logger.Instance.err(e)}}))}removeFile(e){return r.__awaiter(this,void 0,void 0,(function*(){try{(yield this.exists(e))&&(yield this._unlink(e))}catch(e){i.Logger.Instance.err(e)}}))}exists(e){return r.__awaiter(this,void 0,void 0,(function*(){try{return yield this._access(e,n.constants.F_OK),!0}catch(e){return!1}}))}}t.FileManager=a},767:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const r=s(780).__importDefault(s(242)),i=s(669).debuglog("cypress-har-generator");class o{static get Instance(){return this._instance||(this._instance=new o),this._instance}info(e){this.log(r.default.blue(`🛈 ${e}`))}err(e){this.log(r.default.red(`🍑 ${e}`))}warn(e){this.log(r.default.yellow(`⚠ ${e}`))}debug(e){i(e)}log(e){console.log(e)}}t.Logger=o},928:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileManager=t.Logger=void 0;var r=s(767);Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return r.Logger}});var i=s(699);Object.defineProperty(t,"FileManager",{enumerable:!0,get:function(){return i.FileManager}})},306:e=>{e.exports=JSON.parse('{"name":"@neuralegion/cypress-har-generator","version":"5.2.3","private":false,"repository":{"type":"git","url":"git+https://github.com/NeuraLegion/cypress-har-generator.git"},"main":"dist/index.js","typings":"dist/index.d.ts","files":["dist","commands.js","commands.js.map"],"author":{"name":"Artem Derevnjuk","email":"artem.derevnjuk@neuralegion.com"},"license":"MIT","bugs":{"url":"https://github.com/NeuraLegion/cypress-har-generator/issues"},"publishConfig":{"access":"public"},"keywords":["cypress","har","cypress-plugin","chrome","http-archive"],"scripts":{"semantic-release":"semantic-release","lint":"eslint -c .eslintrc.js \'src/**/*.ts\'","format":"prettier --check \'src/**/*.ts\'","test":"jest","test:watch":"jest --watch","test:cov":"jest --coverage","build":"webpack --config webpack/webpack.config.ts","prepublishOnly":"npm run build","prepare":"is-ci || husky install"},"homepage":"https://github.com/NeuraLegion/cypress-har-generator#readme","devDependencies":{"@commitlint/cli":"^12.1.1","@commitlint/config-conventional":"^12.1.1","@types/chalk":"^2.2.0","@types/har-format":"^1.2.5","@types/jest":"^26.0.22","@types/node":"~10.12.18","@types/webpack":"^5.28.0","@types/webpack-node-externals":"^2.5.1","@typescript-eslint/eslint-plugin":"^4.20.0","@typescript-eslint/parser":"^4.20.0","cypress":"^7.0.0","devtools-protocol":"~0.0.869921","eslint":"^7.23.0","eslint-config-prettier":"^8.1.0","eslint-plugin-import":"^2.22.1","eslint-plugin-prefer-arrow":"^1.2.3","eslint-plugin-prettier":"^3.3.1","filemanager-webpack-plugin":"^4.0.0","husky":"^6.0.0","is-ci":"^3.0.0","jest":"^26.6.3","lint-staged":"^10.5.4","nyc":"~15.1.0","prettier":"~2.2.1","semantic-release":"^17.4.2","ts-jest":"^26.5.4","ts-loader":"^8.1.0","ts-node":"~9.1.1","tsconfig-paths":"^3.9.0","typescript":"~4.2.3","webpack":"^5.30.0","webpack-cli":"^4.6.0","webpack-node-externals":"^2.5.2"},"commitlint":{"extends":["@commitlint/config-conventional"]},"lint-staged":{"*.{js,ts}":["eslint --fix","prettier --write","git add"]},"jest":{"moduleFileExtensions":["js","json","ts"],"rootDir":"src","testRegex":".spec.ts$","transform":{"^.+\\\\.(t|j)s$":"ts-jest"},"coverageDirectory":"../coverage","testEnvironment":"node"},"dependencies":{"tslib":"^2.2.0","chalk":"^4.1.0","chrome-remote-interface":"~0.30.0"}}')},242:e=>{e.exports=require("chalk")},323:e=>{e.exports=require("chrome-remote-interface")},747:e=>{e.exports=require("fs")},622:e=>{e.exports=require("path")},780:e=>{e.exports=require("tslib")},835:e=>{e.exports=require("url")},669:e=>{e.exports=require("util")}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.ensureBrowserFlags=e.install=void 0;const t=s(23),i=s(928),o=new t.Plugin(i.Logger.Instance,i.FileManager.Instance);e.install=e=>{e("task",{saveHar:e=>o.saveHar(e),recordHar:e=>o.recordHar(e)})},e.ensureBrowserFlags=(e,t)=>{t.args.push(...o.ensureBrowserFlags(e,t.args))}})();var i=exports;for(var o in r)i[o]=r[o];r.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();
//# sourceMappingURL=index.js.map